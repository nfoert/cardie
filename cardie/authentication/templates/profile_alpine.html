{% load static %}

<!DOCTYPE html>
<html>
    <head>
        <script src="https://unpkg.com/@phosphor-icons/web"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

        <link rel="stylesheet" type="text/css" href="{% static '/main/variables.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static '/main/ui.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static '/main/notifications.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static '/main/home.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static '/main/profile.css' %}">
        <link rel="shortcut icon" type="image/png" href="{% static '/main/images/favicon_light.ico' %}"/>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Cardie | Profile</title>
    </head>

    <body>
        <div id="home-top">
            <div id="home-top-logo">
                <img id="home-top-image" src="{% static '/main/images/logo_light.png' %}">
            </div>

            <div id="home-top-profile" x-data="{ open: false }" @click="open = !open" @click.away="open = false">
                <button id="home-top-username" class="ui_button_small">
                    {{ profile.user.username }} <i class="ph-bold ph-caret-down"></i>
                </button>

                <div id="home-top-profile-dropdown" x-show="open" x-transition>
                    <button class="ui_button_small" @click="log_out()">
                        <i class="ph-bold ph-sign-out"></i> Log Out
                    </button>
                </div>
            </div>
        </div>



        <form method="POST" enctype="multipart/form-data" x-ref="profileForm">
    {% csrf_token %}
    <div id="profile-container" x-data="{
        editMode: false,
        toggleEdit() {
            this.editMode = !this.editMode;
        },
        triggerFileInput() {
            this.$refs.fileInput.click();
        },
        handleFileChange(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.querySelector('.profile-image').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }
    }">
        <div id="profile-details">
            <div class="detail-card">
                <h2 class="ui_text_subheader_left">Account Details</h2>
                <div class="info-item ui_text_body">
                    <i class="ph-bold ph-user"></i>
                    <template x-if="!editMode">
                        <span>{{ profile.user.username }}</span>
                    </template>
                    <template x-if="editMode">
                        {{ u_form.username }}
                    </template>
                </div>
                <div class="info-item ui_text_body">
                    <i class="ph-bold ph-envelope"></i>
                    <template x-if="!editMode">
                        <span>{{ profile.user.email }}</span>
                    </template>
                    <template x-if="editMode">
                        {{ u_form.email }}
                    </template>
                </div>
                <div class="info-item ui_text_body">
                    <i class="ph-bold ph-calendar"></i>
                    <span>Created: {{ profile.created_at }}</span>
                </div>
            </div>

            <div class="detail-card">
                <h2 class="ui_text_subheader_left">Account Actions</h2>
                <div class="action-buttons">
                    <!-- Button to toggle edit mode  -->
                    <button type="button" class="ui_button_grid" x-show="!editMode" @click="toggleEdit()">
                        <i class="ph-bold ph-pencil"></i>
                        <span>Edit Profile</span>
                    </button>

                    <!-- Button to submit the form (POST request) -->
                    <button type="submit" class="ui_button_grid" x-show="editMode" @click="$refs.profileForm.submit()">
                        <i class="ph-bold ph-check"></i>
                        <span>Save Changes</span>
                    </button>

                    <button type="button" class="ui_button_grid">
                        <i class="ph-bold ph-key"></i>
                        Change Password
                    </button>
                    <button type="button" class="ui_button_grid">
                        <i class="ph-bold ph-gear"></i>
                        Settings
                    </button>
                </div>
            </div>
        </div>

        <div id="profile-image-container">
            <div class="profile-image-container" @click="editMode && triggerFileInput()">
                <img class="profile-image" src="{{ profile.profile_image.url }}" alt="Profile Image">
                <template x-if="editMode">
                    <div class="profile-image-overlay">
                        <i class="ph-bold ph-camera" style="font-size: 24px;"></i>
                    </div>
                </template>
            </div>
            <input
                type="file"
                name="profile_image"
                x-ref="fileInput"
                @change="handleFileChange"
                accept="image/*"
                style="display: none;">
        </div>
    </div>
</form>



        <script>
            var server_ip = "{{ server_ip }}";
            var production = "{{ production }}";
            var username = "{{ username }}"
        </script>

        <script src="{% static '/main/scripts/home/home.js' %}"></script>
        <script src="{% static '/main/scripts/profile/profile_alpine.js' %}"></script>
        <script src="{% static '/main/scripts/global/favicon.js' %}"></script>
        <script src="{% static '/main/scripts/global/notifications.js' %}"></script>
        <script src="{% static '/main/scripts/global/logging.js' %}"></script>
        <script src="{% static '/main/scripts/global/background_blur.js' %}"></script>
    </body>
</html>

